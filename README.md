# Devops-Tools: 

Devops å·¥å…·é›†

ç›®å‰å·²å®ç°ï¼š
- æ–‡ä»¶å“ˆå¸Œç”Ÿæˆå·¥å…· gen-hash
- æ–‡ä»¶å“ˆå¸ŒéªŒè¯å·¥å…· check-hash

ç”¨äºç»™è‹¥å¹²æ–‡ä»¶ç”Ÿæˆå“ˆå¸Œå€¼å’Œç­¾åï¼Œå¹¶éªŒè¯æ–‡ä»¶çš„å“ˆå¸Œå€¼å’Œç­¾åç¡®ä¿æ–‡ä»¶æœªè¢«ç¯¡æ”¹ã€‚


## å¿«é€Ÿå¼€å§‹

```bash
# ç¼–è¯‘é¡¹ç›®
cargo build --release

# ç®€æ´æ¨¡å¼ï¼šå¿«é€Ÿå¤„ç†æ–‡ä»¶
./target/release/gen-hash -d /path/to/files
# è¾“å‡º: å¤„ç† 10 ä¸ªæ–‡ä»¶...
#       âœ“ å®Œæˆ (2.34s, 1250 MB/s)

# è¯¦ç»†æ¨¡å¼ï¼šæŸ¥çœ‹å¤„ç†è¿‡ç¨‹
./target/release/gen-hash -d /path/to/files -v

# éªŒè¯æ–‡ä»¶
./target/release/check-hash -d /path/to/files
```

## ç‰¹æ€§

- ğŸš€ **é«˜æ€§èƒ½**: åŸºäº BLAKE3 ç®—æ³•ï¼Œæ¯” SHA-256 å¿«æ•°å€
- ğŸ”’ **å®‰å…¨**: æ”¯æŒ RSA æ•°å­—ç­¾åéªŒè¯
- âš¡ **å¹¶è¡Œå¤„ç†**: åˆ©ç”¨å¤šæ ¸ CPU å¹¶è¡Œè®¡ç®—å“ˆå¸Œå€¼
- ğŸ”„ **å…¼å®¹æ€§**: è¾“å‡ºæ ¼å¼å…¼å®¹ `b3sum` å’Œ `sha256sum`
- ğŸ“Š **å¤šæ ¼å¼è¾“å‡º**: æ”¯æŒæ ‡å‡†æ ¼å¼ã€JSON æ ¼å¼è¾“å‡º
- ğŸ› ï¸ **çµæ´»é…ç½®**: æ”¯æŒå¤šç§å“ˆå¸Œç®—æ³•å’Œè‡ªå®šä¹‰å‚æ•°
- ğŸ¯ **ç”¨æˆ·å‹å¥½**: æä¾›ç®€æ´ã€è¯¦ç»†ã€è°ƒè¯•ä¸‰ç§è¾“å‡ºæ¨¡å¼
- ğŸ” **æ™ºèƒ½è¯Šæ–­**: è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œæ€§èƒ½ç»Ÿè®¡

## é¡¹ç›®ç»“æ„

```
rs-tools/
â”œâ”€â”€ gen-hash/          # å“ˆå¸Œç”Ÿæˆå·¥å…·
â”œâ”€â”€ check-hash/        # å“ˆå¸ŒéªŒè¯å·¥å…·
â”œâ”€â”€ shared-lib/        # å…±äº«åº“
â””â”€â”€ README.md
```

## å®‰è£…

### ä»æºç ç¼–è¯‘

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd rs-tools

# ç¼–è¯‘æ‰€æœ‰å·¥å…·
cargo build --release

# ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶ä½äº
# target/release/gen-hash
# target/release/check-hash
```

### ç³»ç»Ÿè¦æ±‚

- Rust 1.70+
- OpenSSL å¼€å‘åº“
- Linux/macOS/Windows

## ä½¿ç”¨æ–¹æ³•

### gen-hash - å“ˆå¸Œç”Ÿæˆå·¥å…·

ç”¨äºè®¡ç®—æ–‡ä»¶å“ˆå¸Œå€¼å¹¶ç”Ÿæˆæ•°å­—ç­¾åï¼Œæ›¿ä»£åŸæœ‰çš„ shell è„šæœ¬ã€‚

#### åŸºæœ¬ç”¨æ³•

```bash
# ç®€æ´æ¨¡å¼ï¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆæ‰€æœ‰ .tar.gz æ–‡ä»¶çš„ BLAKE3 å“ˆå¸Œå’Œç­¾å
./target/release/gen-hash
# è¾“å‡º: å¤„ç† 2 ä¸ªæ–‡ä»¶...
#       âœ“ å®Œæˆ (0.12s, 2056 MB/s)

# è¯¦ç»†æ¨¡å¼ï¼šæ˜¾ç¤ºé…ç½®ä¿¡æ¯å’Œå¤„ç†è¿›åº¦
./target/release/gen-hash -v
# è¾“å‡º: é…ç½®ä¿¡æ¯:
#         ç›®å½•: /path/to/files
#         ç®—æ³•: blake3
#       æ‰¾åˆ° 2 ä¸ªæ–‡ä»¶éœ€è¦å¤„ç†
#       å¼€å§‹å¤„ç†...
#       [1/2] file1.tar.gz (247.62 MB)
#       [2/2] file2.tar.gz (6.20 MB)
#       å¤„ç†å®Œæˆ!

# è°ƒè¯•æ¨¡å¼ï¼šæ˜¾ç¤ºè¯¦ç»†çš„æ€§èƒ½å’Œé”™è¯¯ä¿¡æ¯
./target/release/gen-hash --debug
# è¾“å‡º: é…ç½®ä¿¡æ¯:
#         ç›®å½•: /path/to/files
#         ç®—æ³•: blake3
#         å¹¶è¡Œå¤„ç†: true
#         ç¼“å†²åŒºå¤§å°: 65536 bytes
#       [1/2] file1.tar.gz
#         å¤§å°: 247.62 MB, æƒé™: 644
#         å“ˆå¸Œè®¡ç®—: 0.110s
#         æ–‡ä»¶å†™å…¥: 0.003s

# æŒ‡å®šç›®å½•å’Œç§é’¥
./target/release/gen-hash -d /path/to/files -k /path/to/private.pem

# ä½¿ç”¨ SHA256 ç®—æ³•
./target/release/gen-hash -a sha256

# åŒæ—¶ç”Ÿæˆ BLAKE3 å’Œ SHA256 å“ˆå¸Œ
./target/release/gen-hash -a both

# è¾“å‡º b3sum å…¼å®¹æ ¼å¼
./target/release/gen-hash -f b3sum

# è¾“å‡º JSON æ ¼å¼
./target/release/gen-hash -f json

# ä¸²è¡Œå¤„ç†ï¼ˆæ˜¾ç¤ºå®æ—¶è¿›åº¦ï¼‰
./target/release/gen-hash --no-parallel -v
```

#### å‚æ•°è¯´æ˜

**åŸºæœ¬å‚æ•°**
- `-d, --directory <DIR>`: è¦å¤„ç†çš„ç›®å½•è·¯å¾„ (é»˜è®¤: å½“å‰ç›®å½•)
- `-k, --private-key <FILE>`: ç§é’¥æ–‡ä»¶è·¯å¾„ (é»˜è®¤: `./private_key.pem`)
- `-a, --algorithm <ALGO>`: å“ˆå¸Œç®—æ³• (blake3, sha256, both) (é»˜è®¤: blake3)
- `-e, --extensions <EXT>`: æ–‡ä»¶æ‰©å±•åï¼Œé€—å·åˆ†éš” (é»˜è®¤: tar.gz)

**è¾“å‡ºæ§åˆ¶**
- `-v, --verbose`: è¯¦ç»†è¾“å‡ºï¼ˆæ˜¾ç¤ºé…ç½®ä¿¡æ¯ã€å¤„ç†è¿›åº¦å’Œå®Œæ•´ç»“æœï¼‰
- `--debug`: è°ƒè¯•æ¨¡å¼ï¼ˆæ˜¾ç¤ºæ€§èƒ½ç»Ÿè®¡ã€æ–‡ä»¶æƒé™ç­‰è¯¦ç»†ä¿¡æ¯ï¼‰
- `-f, --format <FORMAT>`: è¾“å‡ºæ ¼å¼ (standard, json, b3sum, sha256sum) (é»˜è®¤: standard)

**æ€§èƒ½é€‰é¡¹**
- `--no-parallel`: ç¦ç”¨å¹¶è¡Œå¤„ç†ï¼ˆä¸²è¡Œæ¨¡å¼ä¸‹æ˜¾ç¤ºå®æ—¶è¿›åº¦ï¼‰
- `-b, --buffer-size <SIZE>`: ç¼“å†²åŒºå¤§å°ï¼Œå­—èŠ‚ (é»˜è®¤: 65536)

**å…¶ä»–é€‰é¡¹**
- `--no-sign`: ä¸ç”Ÿæˆæ•°å­—ç­¾å

#### è¾“å‡ºæ¨¡å¼

**ç®€æ´æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰**
```
å¤„ç† 2 ä¸ªæ–‡ä»¶...
âœ“ å®Œæˆ (0.12s, 2056 MB/s)
```

**è¯¦ç»†æ¨¡å¼ï¼ˆ-vï¼‰**
```
é…ç½®ä¿¡æ¯:
  ç›®å½•: /path/to/files
  ç®—æ³•: blake3
  æ‰©å±•å: ["tar.gz"]
  å¹¶è¡Œå¤„ç†: true
  ç§é’¥: ./private_key.pem

æ‰¾åˆ° 2 ä¸ªæ–‡ä»¶éœ€è¦å¤„ç†
å¼€å§‹å¤„ç†...
[1/2] file1.tar.gz (247.62 MB)
[2/2] file2.tar.gz (6.20 MB)

æ–‡ä»¶å“ˆå¸Œç”Ÿæˆç»“æœ:
--------------------------------------------------------------------------------
æ–‡ä»¶: file1.tar.gz
å¤§å°: 247.62 MB
BLAKE3: 3946499f8a0d78ca3ac14982085646249f5fd417b0723a9366dcd32e0db5e453
ç­¾å: 389403dd145a3fea...
å¤„ç†æ—¶é—´: 0.113s
--------------------------------------------------------------------------------

å¤„ç†å®Œæˆ!
  æ–‡ä»¶æ•°é‡: 2
  æ€»å¤§å°: 253.81 MB
  è€—æ—¶: 0.12s
  ååé‡: 2056.28 MB/s
```

**è°ƒè¯•æ¨¡å¼ï¼ˆ--debugï¼‰**
```
é…ç½®ä¿¡æ¯:
  ç›®å½•: /path/to/files
  ç®—æ³•: blake3
  æ‰©å±•å: ["tar.gz"]
  å¹¶è¡Œå¤„ç†: true
  ç¼“å†²åŒºå¤§å°: 65536 bytes
  ç§é’¥: ./private_key.pem

æ‰¾åˆ° 2 ä¸ªæ–‡ä»¶éœ€è¦å¤„ç†:
  /path/to/files/file1.tar.gz
  /path/to/files/file2.tar.gz

å¼€å§‹å¹¶è¡Œå¤„ç†...
[è¯¦ç»†çš„æ€§èƒ½ç»Ÿè®¡å’Œé”™è¯¯è¯Šæ–­ä¿¡æ¯]
```

#### è¾“å‡ºæ–‡ä»¶

å·¥å…·ä¼šåœ¨ç›®æ ‡ç›®å½•åˆ›å»º `signatures/` å­ç›®å½•ï¼ŒåŒ…å«ï¼š

- `filename.tar.gz.b3`: BLAKE3 å“ˆå¸Œæ–‡ä»¶
- `filename.tar.gz.hash`: SHA256 å“ˆå¸Œæ–‡ä»¶  
- `filename.tar.gz.sig`: æ•°å­—ç­¾åæ–‡ä»¶

### check-hash - å“ˆå¸ŒéªŒè¯å·¥å…·

ç”¨äºéªŒè¯æ–‡ä»¶å“ˆå¸Œå€¼å’Œæ•°å­—ç­¾åï¼Œæ›¿ä»£åŸæœ‰çš„éªŒè¯è„šæœ¬ã€‚

#### åŸºæœ¬ç”¨æ³•

```bash
# éªŒè¯å½“å‰ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶
./target/release/check-hash

# æŒ‡å®šç›®å½•å’Œå…¬é’¥
./target/release/check-hash -d /path/to/files -k /path/to/public.pem

# è‡ªåŠ¨æ£€æµ‹ç®—æ³•
./target/release/check-hash -a auto

# è¯¦ç»†è¾“å‡º
./target/release/check-hash -v

# JSON æ ¼å¼è¾“å‡º
./target/release/check-hash --json

# ä¸¥æ ¼æ¨¡å¼ï¼ˆæ‰€æœ‰æ–‡ä»¶å¿…é¡»é€šè¿‡éªŒè¯ï¼‰
./target/release/check-hash --strict
```

#### å‚æ•°è¯´æ˜

**åŸºæœ¬å‚æ•°**
- `-d, --directory <DIR>`: è¦éªŒè¯çš„ç›®å½•è·¯å¾„ (é»˜è®¤: å½“å‰ç›®å½•)
- `-k, --public-key <FILE>`: å…¬é’¥æ–‡ä»¶è·¯å¾„ (é»˜è®¤: `./public_key.pem`)
- `-a, --algorithm <ALGO>`: å“ˆå¸Œç®—æ³• (blake3, sha256, auto) (é»˜è®¤: auto)
- `-e, --extensions <EXT>`: æ–‡ä»¶æ‰©å±•åï¼Œé€—å·åˆ†éš” (é»˜è®¤: tar.gz)

**è¾“å‡ºæ§åˆ¶**
- `-v, --verbose`: è¯¦ç»†è¾“å‡º
- `--json`: JSON æ ¼å¼è¾“å‡º

**éªŒè¯é€‰é¡¹**
- `--no-verify`: ä¸éªŒè¯æ•°å­—ç­¾å
- `--strict`: ä¸¥æ ¼æ¨¡å¼ï¼ˆæ‰€æœ‰æ–‡ä»¶å¿…é¡»é€šè¿‡éªŒè¯ï¼‰

**æ€§èƒ½é€‰é¡¹**
- `--no-parallel`: ç¦ç”¨å¹¶è¡Œå¤„ç†
- `-b, --buffer-size <SIZE>`: ç¼“å†²åŒºå¤§å°ï¼Œå­—èŠ‚ (é»˜è®¤: 65536)

#### é€€å‡ºç 

- `0`: æ‰€æœ‰æ–‡ä»¶éªŒè¯é€šè¿‡
- `1`: æœ‰æ–‡ä»¶éªŒè¯å¤±è´¥


## é«˜çº§ç”¨æ³•

### ä¸åŒä½¿ç”¨åœºæ™¯

**å¿«é€Ÿæ‰¹é‡å¤„ç†ï¼ˆæ¨èï¼‰**
```bash
# ç®€æ´æ¨¡å¼ï¼Œé€‚åˆè„šæœ¬å’Œè‡ªåŠ¨åŒ–
./gen-hash -d /path/to/files
# è¾“å‡º: å¤„ç† 10 ä¸ªæ–‡ä»¶...
#       âœ“ å®Œæˆ (2.34s, 1250 MB/s)
```

**äº¤äº’å¼ä½¿ç”¨**
```bash
# è¯¦ç»†æ¨¡å¼ï¼Œé€‚åˆæ‰‹åŠ¨æ“ä½œ
./gen-hash -d /path/to/files -v
# æ˜¾ç¤ºé…ç½®ä¿¡æ¯ã€å¤„ç†è¿›åº¦å’Œå®Œæ•´ç»“æœ
```

**é—®é¢˜è¯Šæ–­**
```bash
# è°ƒè¯•æ¨¡å¼ï¼Œé€‚åˆæ’æŸ¥é—®é¢˜
./gen-hash -d /path/to/files --debug
# æ˜¾ç¤ºè¯¦ç»†çš„æ€§èƒ½ç»Ÿè®¡å’Œé”™è¯¯è¯Šæ–­ä¿¡æ¯
```

### æ‰¹é‡å¤„ç†

```bash
# å¤„ç†å¤šä¸ªç›®å½•ï¼ˆç®€æ´è¾“å‡ºï¼‰
for dir in dir1 dir2 dir3; do
    echo "å¤„ç†ç›®å½•: $dir"
    ./gen-hash -d "$dir"
done

# å¹¶è¡Œå¤„ç†å¤šä¸ªç›®å½•
echo -e "dir1\ndir2\ndir3" | xargs -P 3 -I {} ./gen-hash -d {}

# è¯¦ç»†æ¨¡å¼æ‰¹é‡å¤„ç†
for dir in dir1 dir2 dir3; do
    ./gen-hash -d "$dir" -v
done
```

### æ€§èƒ½è°ƒä¼˜

```bash
# å¢å¤§ç¼“å†²åŒºæé«˜å¤§æ–‡ä»¶å¤„ç†æ€§èƒ½
./gen-hash -b 1048576  # 1MB buffer

# ç¦ç”¨å¹¶è¡Œå¤„ç†ï¼ˆä½å†…å­˜ç¯å¢ƒæˆ–éœ€è¦å®æ—¶è¿›åº¦ï¼‰
./gen-hash --no-parallel -v

# ä»…ç”Ÿæˆå“ˆå¸Œï¼Œä¸ç­¾åï¼ˆæé«˜é€Ÿåº¦ï¼‰
./gen-hash --no-sign

# è°ƒè¯•æ€§èƒ½é—®é¢˜
./gen-hash --debug --no-parallel  # æ˜¾ç¤ºè¯¦ç»†è®¡æ—¶ä¿¡æ¯
```

## å¼€å‘

### æ„å»º

```bash
# å¼€å‘æ„å»º
cargo build

# å‘å¸ƒæ„å»º
cargo build --release

# è¿è¡Œæµ‹è¯•
cargo test

# è¿è¡Œç‰¹å®šæ¨¡å—æµ‹è¯•
cargo test -p shared-lib
```

### ä»£ç ç»“æ„

- `shared-lib/`: å…±äº«åŠŸèƒ½åº“
  - `hash.rs`: å“ˆå¸Œè®¡ç®—æ¨¡å—
  - `signature.rs`: æ•°å­—ç­¾åæ¨¡å—
  - `utils.rs`: å·¥å…·å‡½æ•°æ¨¡å—
- `gen-hash/`: å“ˆå¸Œç”Ÿæˆå·¥å…·
- `check-hash/`: å“ˆå¸ŒéªŒè¯å·¥å…·

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼